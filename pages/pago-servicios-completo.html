<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pago de servicios exitoso - PokeBank</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

      <body data-page="pago-servicios-completo"
      class="bg-[#F4EFEB] min-h-screen flex flex-col item-center justify-center">

    <!-- Contenedor principal -->
    <div class="flex flex-col items-center px-8 pb-10">
       
    <!-- Tarjeta del comprobante en el pdf-->
    <div
      id="comprobante"
      class="bg-[#FDF8F6]
             rounded-xl shadow-md
             px-10 py-8
             max-w-[320px] w-full
             flex flex-col items-center"
       >

      <!-- Logo -->
        <img src="../images/pokemon-bank-logo.png"
             alt="Pokémon Bank"
             class="w-40 mb-6" />

        <!-- Título -->
        <h2 class="text-lg md:text-xl font-semibold text-[#3952A5] mb-2">
            Pago de servicios exitoso
        </h2>

        <!-- Check de confirmación -->
        <svg xmlns="http://www.w3.org/2000/svg"
             fill="none"
             viewBox="0 0 24 24"
             stroke-width="2.5"
             stroke="#2ECC71"
             class="w-8 h-8 mb-8">
            <path stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M4.5 12.75l6 6 9-13.5" />
        </svg>

        <!-- Detalles del pago de servicios -->
            <div class="text-center text-[#3952A5] space-y-2">
            <div>
                <p class="font-semibold">Servicio</p>
                <p id="lblServicio" class="text-gray-600 mb-2">Electricidad</p>
            </div>

            <div>
                <p class="font-semibold">Proveedor</p>
                <p id="lblProveedor" class="text-gray-600 mb-2">CLESA</p>
            </div>

            <div>
                <p class="font-semibold">N° de referencia / NIC</p>
                <p id="lblReferencia" class="text-gray-600 mb-2">00123456789</p>
            </div>

            <div>
                <p class="font-semibold">Cuenta de origen</p>
                <p id="lblCuentaOrigen" class="text-gray-600 mb-2">
                    0034840280021393
                </p>
            </div>

            <div>
                <p class="font-semibold">Monto</p>
                <p id="lblMonto" class="text-gray-600">$ 75.00</p>
            </div>
        </div>
    </div>

<!-- Botón Imprimir comprobante -->
      <div class="mt-6 flex justify-center w-full">
        <button
          id="btnImprimirPdf"
          class="w-64
                 flex items-center justify-center gap-3
                 bg-[#ff9800] hover:bg-[#f48b00]
                 text-white font-semibold
                 py-3 px-6
                 rounded-xl
                 shadow-md hover:shadow-lg
                 transition"
        >
          <!-- Ícono impresora -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 9V4h12v5M6 18H5a2 2 0 01-2-2v-4a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2h-1m-12 0h12v3H6v-3z"
            />
          </svg>
          <span>Imprimir comprobante</span>
        </button>
      </div>
    </div>

       
     <!-- Flecha verde fija abajo a la derecha -->
  <a
    id="btnRetorno"
    href="../index.html"
    class="fixed bottom-8 right-8 flex items-center justify-center
           w-12 h-12 rounded-full border border-green-400
           text-green-500 hover:bg-green-50 hover:text-green-600
           transition shadow-md"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="2"
      stroke="currentColor"
      class="w-6 h-6 rotate-180"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M15 19l-7-7 7-7"
      />
    </svg>
  </a>

   <!-- Librerías para el PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Lógica para generar el PDF-->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const comprobante = document.getElementById("comprobante");
      const btnImprimir = document.getElementById("btnImprimirPdf");

      if (!comprobante || !btnImprimir) {
        console.error("No se encontró el comprobante o el botón");
        return;
      }

      btnImprimir.addEventListener("click", function () {
        
        // Validar librerías
        if (typeof html2canvas === "undefined" || !window.jspdf) {
          console.error("Faltan html2canvas o jsPDF");
          alert("No se pudo generar el comprobante en PDF.");
          return;
        }

        const jsPDF = window.jspdf.jsPDF;

        // Capturar el comprobante como imagen
        html2canvas(comprobante, {
          scale: 3,
          backgroundColor: "#F4EFEB",
        })
          .then(function (canvas) {
            const imgData = canvas.toDataURL("image/png");

            // PDF tamaño 
            const pdf = new jsPDF("p", "mm", "a4");
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();

            const marginX = 20;
            const marginY = 20;
            const maxWidth = pageWidth - marginX * 2;
            const maxHeight = pageHeight - marginY * 2;

            let ratio = maxWidth / canvas.width;
            const scaledHeight = canvas.height * ratio;

            if (scaledHeight > maxHeight) {
              ratio = maxHeight / canvas.height;
            }

            const imgWidth = canvas.width * ratio;
            const imgHeight = canvas.height * ratio;

            const posX = (pageWidth - imgWidth) / 2;
            const posY = (pageHeight - imgHeight) / 2;

            pdf.addImage(
              imgData,
              "PNG",
              posX,
              posY,
              imgWidth,
              imgHeight,
              undefined,
              "FAST"
            );

            // Referencia desde localStorage.ultimoPagoServicio
            let ref = "pokebank";
            const rawPago = localStorage.getItem("ultimoPagoServicio");
            if (rawPago) {
              try {
                const pago = JSON.parse(rawPago);
                if (pago.referencia) {
                  ref = pago.referencia;
                }
              } catch (e) {
                console.warn("No se pudo parsear ultimoPagoServicio:", e);
              }
            }

            pdf.save("comprobante-pago-servicio-" + ref + ".pdf");
          })
          .catch(function (err) {
            console.error("Error al generar el PDF:", err);
            if (typeof swal === "function") {
              swal(
                "Error",
                "No se pudo generar el comprobante en PDF.",
                "error"
              );
            } else {
              alert("No se pudo generar el comprobante en PDF.");
            }
          });
      });
    });
  </script>

    <script type="module" src="../js/app.js"></script>
</body>
</html>
